<div class="projects-project-issue-list">
  <main class="body">
    <section class="div">
      <!-- Sidebar Navigation -->
      <app-sidebar></app-sidebar>

      <!-- Main Content Area -->
      <main class="div23">
        <!-- Top Header -->
        <header class="header">
          <div class="div24">
            <h3 class="project-workspace">Project Workspace</h3>
            <div class="div25">
              <div class="owner">OWNER</div>
            </div>
          </div>
          <div class="div26">
            <div class="div27">
              <img class="i-icon7" alt="Search icon" src="/assets/images/i6.svg" />
              <div class="input">
                <input
                  class="search-issues"
                  placeholder="Search issues..."
                  type="text"
                  aria-label="Search issues"
                  [(ngModel)]="searchQuery"
                  (ngModelChange)="onSearchChange()"
                />
              </div>
            </div>
            <button class="notification-button" type="button" (click)="toggleNotifications()">
              <img class="div-icon2" alt="Notifications" src="/assets/images/div1.svg" />
            </button>
            <img class="button-icon" alt="Additional actions" src="/assets/images/button.svg" />
            <div class="notification-panel" *ngIf="showNotifications()">
              <div class="notification-header">Notifications</div>
              <div class="notification-item" *ngFor="let item of notifications">
                <div class="notification-message">{{ item.message }}</div>
                <div class="notification-time">{{ item.time }}</div>
              </div>
            </div>
          </div>
        </header>

        <!-- Main Content -->
        <div class="main">
          <div class="div28">
            <!-- Project Details Section -->
            <div class="div29">
              <div class="div30">
                <div class="vector-parent">
                   <button class="back-button" type="button" (click)="onGoBack()" aria-label="Go back to projects">
                     <img class="vector-icon" alt="Back" src="/assets/images/Vector.svg" />
                   </button>
                   <h3 class="e-commerce-platform">{{ project()?.name || 'Project' }}</h3>
                 </div>
                <div class="main-e-commerce-application-wi-wrapper">
                  <div class="main-e-commerce-application">
                    {{ project()?.name ? '' : 'Loading project details...' }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Tab Navigation & Content -->
            <div class="div-container">
              <!-- Tab Buttons -->
              <div class="div31">
                <div class="div32">
                  <button class="button active" aria-current="page">
                    <div class="john-smith">Issues</div>
                  </button>
                  <button class="button2" [routerLink]="['/app/projects', projectId(), 'members']">
                    <div class="john-smith">Members</div>
                  </button>
                  <button class="button3">
                    <div class="john-smith">Settings</div>
                  </button>
                </div>
              </div>

              <!-- Issues List Content -->
              <div class="main2">
                <!-- Empty State: Show when no issues exist -->
                @if (issueRows.length === 0 && !isLoading()) {
                  <app-no-issues-yet (createIssueRequested)="onOpenCreateIssue()"></app-no-issues-yet>
                }

                <!-- Loaded Issues Content -->
                @if (issueRows.length > 0) {
                  <!-- Filter Bar -->
                  <div class="div33">
                    <div class="div34">
                      <div class="div35">
                        <img class="i-icon8" alt="Filter icon" src="/assets/images/i7.svg" />
                        <div class="input2">
                          <input
                            class="filter-by-title"
                            placeholder="Filter by title..."
                            type="text"
                            aria-label="Filter issues by title"
                            [(ngModel)]="searchQuery"
                            (ngModelChange)="onSearchChange()"
                          />
                        </div>
                      </div>
                      <app-dropdown
                        [options]="statusDropdownOptions"
                        ariaLabel="Filter by status"
                        [value]="statusFilter"
                        (valueChange)="statusFilter = $event; onFiltersChange()"
                      ></app-dropdown>
                      <app-dropdown
                        [options]="priorityDropdownOptions"
                        ariaLabel="Filter by priority"
                        [value]="priorityFilter"
                        (valueChange)="priorityFilter = $event; onFiltersChange()"
                      ></app-dropdown>
                      <app-dropdown
                        [options]="assigneeOptions()"
                        ariaLabel="Filter by assignee"
                        [value]="assigneeFilter"
                        (valueChange)="assigneeFilter = $event; onFiltersChange()"
                      ></app-dropdown>
                      <div class="select">
                        <input
                          class="filter-by-title"
                          placeholder="Tag"
                          type="text"
                          aria-label="Filter by tag"
                          [(ngModel)]="tagQuery"
                          (ngModelChange)="onFiltersChange()"
                        />
                      </div>
                      <app-dropdown
                        [options]="sortDropdownOptions"
                        ariaLabel="Sort issues"
                        [value]="sortFilter"
                        (valueChange)="sortFilter = $event; onFiltersChange()"
                      ></app-dropdown>
                      <div class="div36"></div>
                      <button
                        class="button4"
                        aria-label="Create new issue"
                        type="button"
                        (click)="onOpenCreateIssue()"
                      >
                        <img class="i-icon9" alt="Plus icon" src="/assets/images/i8.svg" />
                        <div class="new-issue">New Issue</div>
                      </button>
                    </div>
                  </div>

                  <!-- Issues Table -->
                  <div class="div37">
                    <div class="div38">
                      <!-- Table Header -->
                      <div class="div39">
                        <div class="frame5">
                          <div class="div40">
                            <div class="issue">Issue</div>
                          </div>
                        </div>
                        <div class="frame6">
                          <div class="div40">
                            <div class="issue">Status</div>
                          </div>
                        </div>
                        <div class="frame7">
                          <div class="div40">
                            <div class="recent-projects">Priority</div>
                          </div>
                        </div>
                        <div class="frame8">
                          <div class="div40">
                            <div class="issue">Assignee</div>
                          </div>
                        </div>
                        <div class="frame9">
                          <div class="div40">
                            <div class="issue">Updated</div>
                          </div>
                        </div>
                      </div>

                      <!-- Table Rows -->
                      @for (item of issueRows; track item.id) {
                      <div
                        class="issue-row-wrapper"
                        (click)="onIssueSelected(item.id)"
                        (keydown.enter)="onIssueSelected(item.id)"
                        role="button"
                        tabindex="0"
                      >
                        <app-issue-row
                          [issueId]="item.id.toString()"
                          [issueTitle]="item.title"
                          [category]="''"
                          [type]="''"
                          [statusLabel]="item.status"
                          [priorityLabel]="item.priority"
                          [assigneeAvatar]="'/assets/images/img.svg'"
                          [assigneeName]="toAssigneeLabel(item.assigneeUserId)"
                          [updatedTime]="item.updatedAt"
                          [borderBottom]="''"
                          [padding]="''"
                          [titleFlex]="''"
                          [categoryPadding]="''"
                          [categoryColor]="''"
                          [categoryFlex]="''"
                          [categoryDisplay]="''"
                          [typeWidth]="''"
                          [typeColor]="''"
                          [typeDisplay]="''"
                          [typeFlex]="''"
                          [statusBgColor]="''"
                          [statusPadding]="''"
                          [statusColor]="''"
                          [priorityBgColor]="''"
                          [priorityPadding]="''"
                          [priorityColor]="''"
                          [assigneeOverflow]="''"
                          [assigneeColor]="''"
                          [timelineFlex]="''"
                        ></app-issue-row>
                      </div>
                      }
                    </div>

                    <!-- Pagination -->
                    <div class="div45">
                      <div class="div46">
                        <div class="showing">{{ paginationLabel() }}</div>
                      </div>
                      <div class="div50">
                        <button
                          class="button5"
                          aria-label="Previous page"
                          type="button"
                          (click)="onPrevPage()"
                          [disabled]="!hasPrevPage"
                        >
                          <img class="button-icon2" alt="Previous page" src="/assets/images/button1.svg" />
                        </button>
                        <button class="button6" aria-label="Current page" type="button" aria-current="page">
                          <div class="div52">{{ currentPage() }}</div>
                        </button>
                        <button
                          class="button7"
                          aria-label="Next page"
                          type="button"
                          (click)="onNextPage()"
                          [disabled]="!hasNextPage"
                        >
                          <img class="button-icon3" alt="Next page" src="/assets/images/button2.svg" />
                        </button>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      </main>
    </section>
  </main>

  <create-issue-modal
    *ngIf="isCreateIssueOpen()"
    [projectId]="projectId()"
    (closed)="onCloseCreateIssue()"
    (created)="onIssueCreated($event)"
  ></create-issue-modal>
</div>
