<div class="projects-page-project-list">
  <main class="body">
    <section class="page-wrapper">
      <!-- Sidebar Component -->
      <app-sidebar></app-sidebar>

      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Header -->
        <header class="page-header">
          <div class="header-title-section">
            <h1 class="page-title">Project Workspace</h1>
            <div class="user-role">
              <span class="role-label">{{ role }}</span>
            </div>
          </div>

          <div class="header-controls">
            <!-- Search Bar -->
            <div class="search-container">
              <img class="search-icon" alt="Search" src="assets/i6.svg" />
              <input
                class="search-input"
                type="text"
                placeholder="Search issues..."
                [(ngModel)]="searchIssuesQuery"
                name="searchIssuesQuery"
                (input)="onSearchIssues($event.target.value)"
              />
              <div class="issue-results-panel" *ngIf="showIssueResults()">
                <div
                  class="issue-result-item"
                  *ngFor="let issue of issueResults()"
                  (click)="onIssueResultClick(issue)"
                >
                  <span class="issue-result-title">{{ issue.title }}</span>
                  <span class="issue-result-status">{{ issue.status }}</span>
                </div>
                <div class="issue-result-item empty" *ngIf="issueResults().length === 0">
                  No issues found.
                </div>
              </div>
            </div>

            <!-- Header Icons -->
            <button class="notification-button" type="button" (click)="onNotificationClick()">
              <img class="header-icon notification-icon" alt="Notifications" src="assets/div1.svg" />
            </button>
            <img class="header-icon settings-icon" alt="Settings" src="assets/button.svg" (click)="onSettingsClick()" />
            <div class="notification-panel" *ngIf="showNotifications()">
              <div class="notification-header">Notifications</div>
              <div class="notification-item" *ngFor="let item of notifications">
                <div class="notification-message">{{ item.message }}</div>
                <div class="notification-time">{{ item.time }}</div>
              </div>
            </div>
          </div>
        </header>

        <!-- Main Content -->
        <div class="main-wrapper">
          <form class="content-form">
            <!-- Title Section with New Project Button -->
            <div class="section-header">
              <div class="title-container">
                <h2 class="section-title">Projects</h2>
                <p class="section-description">Your workspaces and issue tracking environments.</p>
              </div>
              <button class="new-project-button" type="button" (click)="onNewProject()">
                <img class="button-icon" alt="Add" src="assets/i7.svg" />
                <span class="button-text">New Project</span>
              </button>
            </div>

            <!-- View Controls -->
            <div class="view-controls">
              <div class="view-mode-toggle">
                <button
                  type="button"
                  class="view-button"
                  [class.active]="viewMode() === 'grid'"
                  (click)="toggleViewMode('grid')"
                >
                  <img class="button-icon" alt="Grid view" src="assets/i8.svg" />
                  <span class="view-label">Grid</span>
                </button>
                <button
                  type="button"
                  class="view-button"
                  [class.active]="viewMode() === 'table'"
                  (click)="toggleViewMode('table')"
                >
                  <img class="button-icon" alt="Table view" src="assets/i9.svg" />
                  <span class="view-label">Table</span>
                </button>
              </div>

              <div class="filters-section">
                <!-- Search Projects -->
                <div class="search-projects">
                  <img class="search-icon" alt="Search" src="assets/i6.svg" />
                  <input
                    class="search-input"
                    type="text"
                    placeholder="Search projects..."
                    [ngModel]="searchQuery()"
                    name="searchProjectsQuery"
                    (ngModelChange)="onSearchProjects($event)"
                  />
                </div>

                <!-- Filter Dropdown -->
                <app-dropdown
                  [options]="filterOptions"
                  ariaLabel="Filter projects"
                  [value]="filterBy()"
                  (valueChange)="onFilterChange($any($event))"
                ></app-dropdown>

                <!-- Sort Dropdown -->
                <app-dropdown
                  [options]="sortOptions"
                  ariaLabel="Sort projects"
                  [value]="sortBy()"
                  (valueChange)="onSortChange($any($event))"
                ></app-dropdown>
              </div>
            </div>

            <div class="projects-grid" *ngIf="hasProjects; else emptyState">
              <app-project-card
                *ngFor="let project of projects; trackBy: trackProject"
                [projectIcon]="'assets/div2.svg'"
                [projectName]="project.name"
                [projectRole]="role"
                [ownerEmail]="project.ownerEmail"
                [createdDate]="'Created on ' + (project.createdAt | date: 'MMM d, yyyy')"
                [projectDescription]="'Issue tracking and project management workspace.'"
                [openIssuesIcon]="'assets/i10.svg'"
                [openIssuesCount]="'0 Open Issues'"
                [statusIcon]="'assets/i11.svg'"
                [statusLabel]="'Active'"
                [roleBgColor]="role === 'OWNER' ? '#dbeafe' : '#ede9fe'"
                [rolePadding]="'4px 10px'"
                [roleColor]="role === 'OWNER' ? '#2563eb' : '#7c3aed'"
                [issuesGap]="'12px'"
                [issuesMinWidth]="'180px'"
                [issuesBgColor]="'#dcfce7'"
                [issuesPadding]="'4px 12px'"
                [issuesTextColor]="'#16a34a'"
                [statusColor]="'#16a34a'"
                (openProject)="onOpenProject(project)"
              ></app-project-card>
            </div>
            <ng-template #emptyState>
              <div class="projects-grid empty">
                <div class="empty-message">No projects yet.</div>
              </div>
            </ng-template>

            <!-- Project Count -->
            <div class="pagination-section" *ngIf="allProjects().length > 0">
              <div class="pagination-info">
                <div class="pagination-text">
                  Showing {{ filteredProjects().length }} of {{ allProjects().length }} projects
                </div>
              </div>
            </div>
          </form>
        </div>
      </main>
    </section>
  </main>
</div>

<app-create-new-project-modal
  *ngIf="isCreateProjectOpen()"
  (closed)="onCreateProjectClosed()"
  (created)="onProjectCreated($event)"
></app-create-new-project-modal>
